@Slf4j
public class RetryUtil {

    public static <T> T executeWithRetry(Callable<T> callable, int maxAttempts, long delayMillis) {
        int attempt = 1;

        while (true) {
            try {
                return callable.call();
            } catch (Exception e) {
                log.error("Attempt {} failed: {}", attempt, e.getMessage());

                if (attempt >= maxAttempts) {
                    log.error("All retry attempts failed");
                    throw new RuntimeException(e);
                }

                try {
                    Thread.sleep(delayMillis);
                } catch (InterruptedException ignored) {}
                attempt++;
            }
        }
    }
}



public void processFile(String fileName) {

    byte[] fileContent = RetryUtil.executeWithRetry(
            () -> readFileFromS3(fileName),
            3,
            2000
    );

    RetryUtil.executeWithRetry(
            () -> uploadFileToSftp("/Archive/" + fileName, fileContent),
            3,
            3000
    );
}



public class RetryResult<T> {
    private final boolean success;
    private final T result;
    private final Exception exception;

    public RetryResult(boolean success, T result, Exception exception) {
        this.success = success;
        this.result = result;
        this.exception = exception;
    }

    public boolean isSuccess() { return success; }
    public T getResult() { return result; }
    public Exception getException() { return exception; }
}



import java.util.concurrent.Callable;

public class RetryUtil {

    public static <T> RetryResult<T> executeWithRetry(Callable<T> callable, int maxAttempts, long delayMillis) {
        int attempt = 1;

        while (true) {
            try {
                T result = callable.call();
                return new RetryResult<>(true, result, null);
            } catch (Exception e) {

                if (attempt >= maxAttempts) {
                    return new RetryResult<>(false, null, e);
                }

                try { Thread.sleep(delayMillis); } 
                catch (InterruptedException ignored) {}

                attempt++;
            }
        }
    }

    public static RetryResult<Void> executeWithRetry(Runnable runnable, int maxAttempts, long delayMillis) {
        return executeWithRetry(() -> {
            runnable.run();
            return null;
        }, maxAttempts, delayMillis);
    }
}

public void processFile(String fileName) {

    RetryResult<byte[]> s3Result = RetryUtil.executeWithRetry(
            () -> readFileFromS3(fileName),
            3,
            2000
    );

    if (!s3Result.isSuccess()) {
        dao.updateStatus(fileName, "FAILED");
        return;
    }

    byte[] fileContent = s3Result.getResult();

    RetryResult<Void> sftpResult = RetryUtil.executeWithRetry(
            () -> uploadFileToSftp("/Archive/" + fileName, fileContent),
            3,
            3000
    );

    if (!sftpResult.isSuccess()) {
        dao.updateStatus(fileName, "FAILED");
        return;
    }

    dao.updateStatus(fileName, "SUCCESS");
}
