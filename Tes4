public class FileReaderService {

    private final SparkSession spark;

    public FileReaderService(SparkSession spark) {
        this.spark = spark;
    }

    public Dataset<Row> readFile(String filePath, String fileType) {
        fileType = fileType.toLowerCase();
        Dataset<Row> df;

        switch (fileType) {
            case "csv":
                df = readCsv(filePath);
                break;
            case "txt":
                df = readTxt(filePath);
                break;
            case "xls":
            case "xlsx":
                df = readExcel(filePath);
                break;
            default:
                throw new IllegalArgumentException("Unsupported file type: " + fileType);
        }
        return df;
    }

    private Dataset<Row> readCsv(String filePath) {
        return spark.read()
                .option("header", "true")
                .option("inferSchema", "true")
                .csv(filePath);
    }

    private Dataset<Row> readTxt(String filePath) {
        return spark.read()
                .text(filePath);
    }

    private Dataset<Row> readExcel(String filePath) {
        return spark.read()
                .format("com.crealytics.spark.excel")
                .option("dataAddress", "'Sheet1'!A1")
                .option("header", "true")
                .option("inferSchema", "true")
                .option("workbookPassword", null)  // if password protected, replace null
                .load(filePath);
    }
}
