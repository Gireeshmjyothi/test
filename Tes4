@Slf4j
public class RetryUtil {

    public static <T> T executeWithRetry(Callable<T> callable, int maxAttempts, long delayMillis) {
        int attempt = 1;

        while (true) {
            try {
                return callable.call();
            } catch (Exception e) {
                log.error("Attempt {} failed: {}", attempt, e.getMessage());

                if (attempt >= maxAttempts) {
                    log.error("All retry attempts failed");
                    throw new RuntimeException(e);
                }

                try {
                    Thread.sleep(delayMillis);
                } catch (InterruptedException ignored) {}
                attempt++;
            }
        }
    }
}



public void processFile(String fileName) {

    byte[] fileContent = RetryUtil.executeWithRetry(
            () -> readFileFromS3(fileName),
            3,
            2000
    );

    RetryUtil.executeWithRetry(
            () -> uploadFileToSftp("/Archive/" + fileName, fileContent),
            3,
            3000
    );
}
