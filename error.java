org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 68.0 failed 1 times, most recent failure: Lost task 0.0 in stage 68.0 (TID 38) (DESKTOP-8ED0TAP.CORP.AD.SBI executor driver): java.lang.IllegalAccessError: class org.apache.spark.sql.catalyst.util.SparkDateTimeUtils (in unnamed module @0x2177849e) cannot access class sun.util.calendar.ZoneInfo (in module java.base) because module java.base does not export sun.util.calendar to unnamed module @0x2177849e


CREATE TABLE RECONCILIATION_RESULT
    (
        id                  NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
        atrn_num            VARCHAR2(64),
        match_status        VARCHAR2(32),
        mismatch_reason     CLOB,
        source_json         CLOB,
        recon_json          CLOB,
        reconciled_at       TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        batch_date          DATE
    );


private void saveToReconciliationTable(Dataset<Row> dataset, String matchStatus, String reason) {
        if (dataset.isEmpty()) {
            logger.warn("No data to save for matchStatus: {}", matchStatus);
            return;
        }

        Dataset<Row> resultDataset = dataset
                .withColumn("match_status", lit(matchStatus))
                .withColumn("mismatch_reason", lit(reason))
                .withColumn("source_json", functions.to_json(functions.struct(Arrays.stream(dataset.columns()).map(functions::col).toArray(Column[]::new))))
                .withColumn("recon_json", functions.to_json(functions.struct(Arrays.stream(dataset.columns()).map(functions::col).toArray(Column[]::new))))
                .withColumn("reconciled_at", functions.current_timestamp())
                .withColumn("batch_date", functions.current_date());

        resultDataset.printSchema();
        jdbcReaderService.writeToReconFileResult(resultDataset, "RECONCILIATION_RESULT");
    }

public void writeToReconFileResult(Dataset<Row> df, String tableName) {
        df.select("atrn_num", "match_status", "mismatch_reason",
                        "source_json", "recon_json", "reconciled_at", "batch_date"
                ).write()
                .format("jdbc")
                .option("url", jdbcConfig.getJdbcUrl())
                .option("dbtable", tableName)
                .option("user", jdbcUserName)
                .option("password", jdbcPassword)
                .option("driver", jdbcDriver)
                .mode(SaveMode.Append)
                .save();
    }
